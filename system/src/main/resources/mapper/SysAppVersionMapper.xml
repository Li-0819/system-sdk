<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iris.mapper.ISysAppVersionMapper">

    <select id="getList" resultType="com.iris.model.vo.system.SysAppVersionVO">

        select list.id, list.publish_platform, list.publishPlatformName, list.app_type, list.appTypeName, list.app_name, list.version_number, list.is_need_update, list.remark,
        list.is_deleted, list.created_by, list.created_time, list.modified_by, list.modified_time
        from (
        select sav.id, sav.publish_platform, sc1.name publishPlatformName, sav.app_type, sc.name appTypeName, sav.app_name, sav.version_number, sav.is_need_update, sav.remark,
        sav.is_deleted, sav.created_by, sav.created_time, sav.modified_by, sav.modified_time
        from sys_app_version sav
        left join sys_code sc on sc.value = sav.app_type and sc.is_deleted = 0
        left join sys_code sc1 on sc1.value = sav.publish_platform and sc1.is_deleted = 0
        ) list
        <where>
            list.is_deleted = 0
            <if test="sysAppVersionListDTO.appType != null and sysAppVersionListDTO.appType != ''">
                and list.app_type = #{sysAppVersionListDTO.appType}
            </if>
            <if test="sysAppVersionListDTO.appName != null and sysAppVersionListDTO.appName != ''">
                and list.app_name like concat('%',#{sysAppVersionListDTO.appName},'%')
            </if>
            <if test="sysAppVersionListDTO.versionNumber != null and sysAppVersionListDTO.versionNumber != ''">
                and list.version_number = #{sysAppVersionListDTO.versionNumber}
            </if>
            <if test="sysAppVersionListDTO.publishPlatform != null and sysAppVersionListDTO.publishPlatform != ''">
                and list.publish_platform = #{sysAppVersionListDTO.publishPlatform}
            </if>
            <if test="sysAppVersionListDTO.startTime != null and sysAppVersionListDTO.startTime != ''">
                and list.created_time &gt;= #{sysAppVersionListDTO.startTime}
            </if>
            <if test="sysAppVersionListDTO.endTime != null and sysAppVersionListDTO.endTime != ''">
                and list.created_time &lt;= #{sysAppVersionListDTO.endTime}
            </if>
        </where>
        order by list.created_time desc
    </select>

    <select id="getDetail" resultType="com.iris.model.vo.system.SysAppVersionVO">

        select sav.id, sav.publish_platform, sc1.name publishPlatformName, sav.app_type, sc.name appTypeName, sav.app_name, sav.version_number, sav.is_need_update,
                sav.remark, sav.is_deleted, sav.created_by, sav.created_time, sav.modified_by, sav.modified_time
        from sys_app_version sav
            left join sys_code sc on sc.value = sav.app_type and sc.is_deleted = 0
            left join sys_code sc1 on sc1.value = sav.publish_platform  and sc1.is_deleted = 0
        where sav.id = #{id} and sav.is_deleted = 0
    </select>
</mapper>